<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><title>hhbot Viewer</title>
<style>
body { margin:0; font-family:sans-serif; display:flex; flex-direction:column; height:100vh; background:#111; color:#fff; }
#iframe { flex:1; }
#messages { flex:1; overflow-y:auto; padding:5px; background:#222; }
#chatbox { display:flex; padding:5px; }
#chatbox input { flex:1; padding:8px; font-size:16px; }
#chatbox button { padding:8px 16px; font-size:16px; }
</style>
</head>
<body>
<iframe id="iframe" src=""></iframe>
<div id="messages"></div>
<div id="chatbox">
<input id="msg" type="text" placeholder="Type a message..." />
<button onclick="sendMessage()">Send</button>
</div>
<script>
const messages = document.getElementById('messages');
const urlParams = new URLSearchParams(window.location.search);
const port = urlParams.get('port') || 3001;

const evtSource = new EventSource('/viewer/' + port + '/chatstream');
evtSource.onmessage = e => {
  const div = document.createElement('div');
  div.innerHTML = e.data;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
};

function sendMessage() {
  const msg = document.getElementById('msg').value;
  if(!msg) return;
  fetch('/viewer/'+port+'/send', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({message:msg}) });
  document.getElementById('msg').value='';
}
</script>
</body>
</html>
